{{ define "layout" }}
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ .Title }}</title>
    <link rel="stylesheet" href="/assets/app.css?v=22_6_help_tip_css_fix" />
</head>
<body class="min-h-screen bg-slate-950 text-slate-100">
    <div class="min-h-screen md:flex">
        <aside class="border-b border-slate-800 bg-slate-900/60 md:min-h-screen md:w-72 md:border-b-0 md:border-r">
            <div class="px-5 py-5">
                <p class="text-xs uppercase tracking-[0.2em] text-slate-400">Verifier Engine Room</p>
                <h1 class="mt-1 text-xl font-semibold">Go Worker Control Center</h1>
            </div>

            <nav class="px-3 pb-5 text-sm">
                <div class="px-2 pb-2 text-[11px] uppercase tracking-[0.16em] text-slate-500">Ops</div>
                <div class="space-y-1">
                    <a class="block rounded-lg px-3 py-2 {{ if eq .ActiveNav "overview" }}bg-amber-500 text-slate-900{{ else }}text-slate-200 hover:bg-slate-800{{ end }}" href="{{ .BasePath }}/overview">Overview</a>
                    <a class="block rounded-lg px-3 py-2 {{ if eq .ActiveNav "workers" }}bg-amber-500 text-slate-900{{ else }}text-slate-200 hover:bg-slate-800{{ end }}" href="{{ .BasePath }}/workers">Workers</a>
                    <a class="block rounded-lg px-3 py-2 {{ if eq .ActiveNav "alerts" }}bg-amber-500 text-slate-900{{ else }}text-slate-200 hover:bg-slate-800{{ end }}" href="{{ .BasePath }}/alerts">Alerts</a>
                </div>

                <div class="mt-5 px-2 pb-2 text-[11px] uppercase tracking-[0.16em] text-slate-500">Infra</div>
                <div class="space-y-1">
                    {{ if .ShowProvisioning }}
                    <a class="block rounded-lg px-3 py-2 {{ if eq .ActiveNav "provisioning" }}bg-amber-500 text-slate-900{{ else }}text-slate-200 hover:bg-slate-800{{ end }}" href="{{ .BasePath }}/provisioning">Provisioning</a>
                    <a class="block rounded-lg px-3 py-2 {{ if eq .ActiveNav "servers" }}bg-amber-500 text-slate-900{{ else }}text-slate-200 hover:bg-slate-800{{ end }}" href="{{ .BasePath }}/servers">Servers</a>
                    {{ end }}
                    <a class="block rounded-lg px-3 py-2 {{ if eq .ActiveNav "pools" }}bg-amber-500 text-slate-900{{ else }}text-slate-200 hover:bg-slate-800{{ end }}" href="{{ .BasePath }}/pools">Pools</a>
                </div>

                <div class="mt-5 px-2 pb-2 text-[11px] uppercase tracking-[0.16em] text-slate-500">Governance</div>
                <div class="space-y-1">
                    <a class="block rounded-lg px-3 py-2 {{ if eq .ActiveNav "settings" }}bg-amber-500 text-slate-900{{ else }}text-slate-200 hover:bg-slate-800{{ end }}" href="{{ .BasePath }}/settings">Settings</a>
                </div>
            </nav>
        </aside>

        <div class="min-w-0 flex-1">
            <header class="border-b border-slate-800 bg-slate-900/40">
                <div class="mx-auto flex max-w-[88rem] flex-wrap items-center justify-between gap-3 px-6 py-4">
                    <div class="text-sm text-slate-300">{{ .Subtitle }}</div>
                    <div class="flex items-center gap-3">
                        <button id="go-theme-toggle" type="button" class="rounded-full border border-slate-700 px-3 py-1 text-xs text-slate-200 hover:bg-slate-800">Light</button>
                        {{ if .DocsURL }}
                        <a href="{{ .DocsURL }}" target="_blank" class="rounded-full border border-slate-700 px-3 py-1 text-xs text-slate-200 hover:bg-slate-800">Docs</a>
                        {{ end }}
                    </div>
                </div>
            </header>

            <main class="mx-auto max-w-[88rem] px-6 py-8">
                {{ if eq .ContentTemplate "overview" }}
                    {{ template "overview" . }}
                {{ else if eq .ContentTemplate "workers_runtime" }}
                    {{ template "workers_runtime" . }}
                {{ else if eq .ContentTemplate "provisioning" }}
                    {{ template "provisioning" . }}
                {{ else if eq .ContentTemplate "servers" }}
                    {{ template "servers" . }}
                {{ else if eq .ContentTemplate "server_manage" }}
                    {{ template "server_manage" . }}
                {{ else if eq .ContentTemplate "server_edit" }}
                    {{ template "server_edit" . }}
                {{ else if eq .ContentTemplate "pools" }}
                    {{ template "pools" . }}
                {{ else if eq .ContentTemplate "alerts" }}
                    {{ template "alerts" . }}
                {{ else if eq .ContentTemplate "settings" }}
                    {{ template "settings" . }}
                {{ end }}
            </main>
        </div>
    </div>

    <div id="cp-confirm-modal" class="fixed inset-0 z-[120] hidden items-center justify-center bg-slate-950/70 p-4" role="presentation" aria-hidden="true">
        <div class="w-full max-w-lg rounded-2xl border border-slate-700 bg-slate-900 p-6 shadow">
            <h2 id="cp-confirm-modal-title" class="text-lg font-semibold text-slate-100">Confirm Action</h2>
            <p id="cp-confirm-modal-message" class="mt-3 text-sm text-slate-300"></p>
            <div class="mt-6 flex justify-end gap-2">
                <button id="cp-confirm-modal-cancel" type="button" class="rounded-full border border-slate-600 bg-slate-900 px-4 py-2 text-xs font-semibold text-slate-200 hover:bg-slate-800">Cancel</button>
                <button id="cp-confirm-modal-confirm" type="button" class="rounded-full bg-amber-500 px-4 py-2 text-xs font-semibold text-slate-900 hover:bg-amber-400">OK</button>
            </div>
        </div>
    </div>

    <script>
        (() => {
            const storageKey = 'go-control-plane-theme';
            const body = document.body;
            const toggle = document.getElementById('go-theme-toggle');
            if (!body || !toggle) {
                return;
            }

            const applyTheme = (theme) => {
                const next = theme === 'light' ? 'light' : 'dark';
                body.classList.toggle('theme-light', next === 'light');
                toggle.textContent = next === 'light' ? 'Dark' : 'Light';
                toggle.setAttribute('aria-label', `Switch to ${next === 'light' ? 'dark' : 'light'} theme`);
                window.dispatchEvent(new CustomEvent('cp:theme-change', { detail: { theme: next } }));
            };

            const stored = window.localStorage.getItem(storageKey);
            applyTheme(stored === 'light' ? 'light' : 'dark');

            toggle.addEventListener('click', () => {
                const next = body.classList.contains('theme-light') ? 'dark' : 'light';
                window.localStorage.setItem(storageKey, next);
                applyTheme(next);
            });
        })();
    </script>

    <script>
        (() => {
            const modal = document.getElementById('cp-confirm-modal');
            const titleNode = document.getElementById('cp-confirm-modal-title');
            const messageNode = document.getElementById('cp-confirm-modal-message');
            const cancelButton = document.getElementById('cp-confirm-modal-cancel');
            const confirmButton = document.getElementById('cp-confirm-modal-confirm');
            if (!modal || !titleNode || !messageNode || !cancelButton || !confirmButton) {
                return;
            }

            let pendingForm = null;

            const closeModal = () => {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
                modal.setAttribute('aria-hidden', 'true');
                document.body.classList.remove('overflow-hidden');
            };

            const openModal = (title, message) => {
                titleNode.textContent = title;
                messageNode.textContent = message;
                modal.classList.remove('hidden');
                modal.classList.add('flex');
                modal.setAttribute('aria-hidden', 'false');
                document.body.classList.add('overflow-hidden');
                cancelButton.focus();
            };

            document.addEventListener('submit', (event) => {
                const form = event.target;
                if (!(form instanceof HTMLFormElement)) {
                    return;
                }

                const message = form.getAttribute('data-confirm-message');
                if (!message) {
                    return;
                }

                if (form.getAttribute('data-confirm-bypass') === '1') {
                    form.removeAttribute('data-confirm-bypass');
                    return;
                }

                event.preventDefault();
                pendingForm = form;
                const title = form.getAttribute('data-confirm-title') || 'Confirm Action';
                openModal(title, message);
            }, true);

            cancelButton.addEventListener('click', () => {
                pendingForm = null;
                closeModal();
            });

            confirmButton.addEventListener('click', () => {
                if (!pendingForm) {
                    closeModal();
                    return;
                }

                const form = pendingForm;
                pendingForm = null;
                form.setAttribute('data-confirm-bypass', '1');
                closeModal();

                if (typeof form.requestSubmit === 'function') {
                    form.requestSubmit();
                    return;
                }

                form.submit();
                form.removeAttribute('data-confirm-bypass');
            });

            modal.addEventListener('click', (event) => {
                if (event.target !== modal) {
                    return;
                }
                pendingForm = null;
                closeModal();
            });

            window.addEventListener('keydown', (event) => {
                if (event.key !== 'Escape' || modal.classList.contains('hidden')) {
                    return;
                }
                pendingForm = null;
                closeModal();
            });
        })();
    </script>

    {{ if .LiveStreamPath }}
    <script>
        (() => {
            const source = new EventSource('{{ .LiveStreamPath }}');
            const close = () => {
                try {
                    source.close();
                } catch (_) {}
            };

            source.addEventListener('stats', (event) => {
                try {
                    const payload = JSON.parse(event.data);
                    window.dispatchEvent(new CustomEvent('cp:live', { detail: payload }));
                } catch (_) {}
            });

            source.addEventListener('error', () => {
                // Browser reconnect is automatic.
            });

            window.addEventListener('pagehide', close);
            window.addEventListener('beforeunload', close);
        })();
    </script>
    {{ end }}
</body>
</html>
{{ end }}
